<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABi0lEQVQ4jZWTzUoDQRSGn3nEiE2EBE4RhDEBKUgkRhElFhE4hAiyELKGIYVxUopZsLM2OwIViAl/BkPZzI/5l5rKpG/JN+vHfL87HPxfwVJ1rZGrq7DdA/TVdqgsbyG7PBXxTnTkR7rAwtg2zKkecwlFw2ymTwn2grSlok8Z9BkybZ8s7C+RpnkNnHvRZXYb6cgCfrTb/IOkZVwdgOYcN6bdKzNR1mMZxjhHqO+Rps8ZnJrR2gk9LfIFlH0ztnzG0YwU1RX8ayFg6yEzZ8cIRZLOOfIVw5E8+Q5jM0y0r3ZcXJ2GvnU4GvQAVVqk9p0FcqN/zwQ2qyn5XSc86kgnY1kVnJcY+3XK1bWmZfOBuQ5Wz4z/wLK8V6XwsuFj6s2yGVpX/zW/AzLO12CzKN8xAAAAAElFTkSuQmCC">

    <title>Terminal Weather</title>

    <style>
        body {
            margin: 0;
            background: #1e1e1e;
            font-family: "Menlo", "Courier New", monospace;
            color: #33ff33;
            height: 100vh;
        }

        /* ---- macOS Terminal Window ---- */
        .terminal-window {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 0 20px #000;
            background: #000;
        }

        .terminal-header {
            background: #2b2b2b;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mac-btn {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .mac-btn.red {
            background: #ff5f57;
        }

        .mac-btn.yellow {
            background: #ffbd2e;
        }

        .mac-btn.green {
            background: #27c93f;
        }

        /* ---- Terminal Body ---- */
        .terminal-body {
            padding: 20px;
            white-space: pre-wrap;
            font-size: 1.1rem;
            line-height: 1.6rem;
        }

        /* Scrolling for forecast */
        .scroll-block {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-left: 3px solid #33ff33;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.4rem;
        }

        .ascii-icon {
            font-size: 1.2rem;
            line-height: 1.2;
            margin-bottom: 10px;
            white-space: pre;
        }
    </style>
</head>

<body>

    <div class="terminal-window">
        <div class="terminal-header">
            <span class="mac-btn red"></span>
            <span class="mac-btn yellow"></span>
            <span class="mac-btn green"></span>
        </div>

        <div class="terminal-body" id="terminal">
            Loading weather data...
        </div>
    </div>

    <script>
        const API_URL = "https://ansel-weather.zeabur.app/api/weather/kaohsiung";

        // ===== ASCII 天氣 ICON =====
        function getAsciiIcon(weather) {
            if (!weather) return "(?)";

            if (weather.includes("晴"))
                return `   \\   /
    .-.
 --(   )--
    \`-’
   /   \\`;

            if (weather.includes("雲"))
                return `  .--.
 (    )
(_)  (_)`;

            if (weather.includes("陰"))
                return `   .--.
 .-(    ).
(__.__.__)`;

            if (weather.includes("雷"))
                return `     .--.
 .-(    ).
(__.__.__)
/\\/\\/\\/`;

            if (weather.includes("雨"))
                return `  .--.
 (    ).
(__.__)
 ' ' '`;

            return "(?)";
        }

        // 小建議 (保留原本 logic)
        function getAdvice(rainProb, maxTemp) {
            let rain = parseInt(rainProb);
            let temp = parseInt(maxTemp);

            let rainText = rain > 30 ? "建議帶傘" : "不需帶傘";
            let clothText = temp >= 28 ? "穿短袖" :
                temp <= 20 ? "加外套" : "舒適穿搭";

            return { rainText, clothText };
        }

        function getTimePeriod(startTime) {
            const hour = new Date(startTime).getHours();
            if (hour >= 5 && hour < 11) return "早晨";
            if (hour >= 11 && hour < 14) return "中午";
            if (hour >= 14 && hour < 18) return "下午";
            if (hour >= 18 && hour < 23) return "晚上";
            return "深夜";
        }


        function renderWeather(data) {
            const t = document.getElementById("terminal");
            const forecasts = data.forecasts;

            const now = forecasts[0];
            const others = forecasts.slice(1);

            const avgTemp = Math.round((parseInt(now.maxTemp) + parseInt(now.minTemp)) / 2);
            const advice = getAdvice(now.rain, now.maxTemp);
            const period = getTimePeriod(now.startTime);

            // ====== 終端機主畫面 ======
            let output = `
> 地區：臺北市
> 當前時段：${period}
> 天氣：${now.weather}
> 平均氣溫：${avgTemp}°C
> 降雨率：${now.rain}

${getAsciiIcon(now.weather)}

建議事項：
- ${advice.rainText}
- ${advice.clothText}

--------------------------------------------------
未來時段預報
`;

            // ====== 稍後預報 ======
            others.forEach(f => {
                output += `
[${getTimePeriod(f.startTime)}]
${getAsciiIcon(f.weather)}
${f.minTemp}°C ~ ${f.maxTemp}°C | 降雨率 ${f.rain}
--------------------------------------------------
`;
            });

            t.textContent = output;
        }

        // Fetch API
        // fetch(API_URL)
        //     .then(res => res.json())
        //     .then(renderWeather)
        //     .catch(err => {
        //         document.getElementById("terminal").textContent = "Error loading data.";
        //         console.error(err);
        //     });
        fetch(API_URL)
            .then(res => {
                console.log("HTTP response:", res);
                return res.json();
            })
            .then(json => {
                console.log("JSON data:", json);
                renderWeather(json.data);
            })
            .catch(err => console.error(err));
    </script>

</body>

</html>
